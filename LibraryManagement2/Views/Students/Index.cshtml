
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "Student Dashboard";
    var username = HttpContextAccessor.HttpContext?.Session.GetString("Username") ?? "Khách";
}

<div class="container mt-4">
    <h2 class="text-center">Bảng Điều Khiển Sinh Viên</h2>

    <div class="card mt-3">
        <div class="card-body">
            <h4 class="card-title">Thông Tin Cá Nhân</h4>
            <p class="card-text">
                Xin chào, <strong>@username</strong>! Bạn đang đăng nhập với <strong>Student</strong>.
            </p>
            @if (TempData["Message"] != null)
            {
                <div class="alert alert-success mt-3" role="alert">
                    @TempData["Message"]
                </div>
            }
        </div>
    </div>

    <div class="card mt-3">
        <div class="card-body">
            <h4 class="card-title">Sách Đã Mượn</h4>
            @* Giả định có model hoặc ViewBag chứa danh sách sách đã mượn *@
            @if (ViewBag.BorrowedBooks != null && ViewBag.BorrowedBooks.Any())
            {
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Tiêu Đề</th>
                            <th>Ngày Mượn</th>
                            <th>Ngày Trả</th>
                            <th>Trạng Thái</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var borrowed in ViewBag.BorrowedBooks)
                        {
                            <tr>
                                <td>@borrowed.Book?.Title</td>
                                <td>@borrowed.BorrowDate?.ToString("dd/MM/yyyy")</td>
                                <td>@(borrowed.ReturnDate?.ToString("dd/MM/yyyy") ?? "Chưa trả")</td>
                                <td>@(borrowed.IsReturned == true ? "Đã trả" : "Chưa trả")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
            else
            {
                <p class="card-text">Bạn chưa mượn sách nào.</p>
            }
        </div>
    </div>

    <div class="text-center mt-4">
        <a asp-controller="Books" asp-action="Index" class="btn btn-info">Xem Tất Cả Sách</a>
        <a asp-controller="Borrowed" asp-action="Create" class="btn btn-success">Mượn Sách Mới</a>
        <a asp-controller="Account" asp-action="Logout" class="btn btn-danger">Đăng Xuất</a>
    </div>
</div>