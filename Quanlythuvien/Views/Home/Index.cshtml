@{
    ViewData["Title"] = "Trang Chủ";
    var books = ViewBag.Books as List<Quanlythuvien.Models.Book> ?? new List<Quanlythuvien.Models.Book>();
}

<div class="container mt-5">
    <h1 class="text-center mb-5 display-4 text-primary">Chào Mừng Đến Với thư viện CT Uni</h1>
    @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
    {
        <div class="alert alert-danger text-center">@ViewBag.ErrorMessage</div>
    }
    @if (!string.IsNullOrEmpty(ViewBag.SearchQuery))
    {
        <div class="alert alert-info text-center">Kết quả tìm kiếm cho: <strong>@ViewBag.SearchQuery</strong></div>
    }

    <!-- Lưới sách -->
    @if (books.Any())
    {
        <div class="row mb-5">
            <div class="col-12">
                <h2 class="text-center mb-4">@(string.IsNullOrEmpty(ViewBag.SearchQuery) ? "Danh Sách Sách Nổi Bật" : "Kết Quả Tìm Kiếm")</h2>
                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4 justify-content-center">
                    @foreach (var book in books)
                    {
                        <div class="col">
                            <div class="card h-100 border-0 shadow-sm position-relative" style="transition: transform 0.2s;">
                                <img src="@(string.IsNullOrEmpty(book.ImagePath) ? "~/images/books/CSharp.jpg" : book.ImagePath)"
                                     class="card-img-top" alt="@book.Title" style="height: 250px; object-fit: cover; border-top-left-radius: 0.25rem; border-top-right-radius: 0.25rem;">
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title text-truncate">@book.Title</h5>
                                    <p class="card-text mb-2"><small>Tác giả: @(string.Join(", ", book.BookAuthors?.Select(ba => ba.Author?.AuthorName) ?? new List<string>()) ?? "Chưa có thông tin")</small></p>
                                    <p class="card-text mb-2"><small>Nhà Xuất Bản: @(book.Publisher?.PublisherName ?? "Chưa có thông tin")</small></p>
                                    <p class="card-text mb-2"><strong>Trạng Thái:</strong> @(book.Quantity > 0 ? "<span class='text-success'>Còn sách</span>" : "<span class='text-danger'>Đã hết sách để mượn</span>")</p>
                                    <div class="mt-auto d-flex gap-2">
                                        <a asp-controller="Books" asp-action="Details" asp-route-id="@book.BookId"
                                           class="btn btn-outline-primary btn-sm w-100">Xem Chi Tiết</a>
                                        @if (book.Quantity > 0 && !string.IsNullOrEmpty(Context.Session?.GetString("UserRole")))
                                        {
                                            if (Context.Session.GetString("UserRole") == "Student" || Context.Session.GetString("UserRole") == "Librarian")
                                            {
                                                <a asp-controller="Borrowed" asp-action="RegisterBorrow" asp-route-bookId="@book.BookId"
                                                   class="btn btn-outline-success btn-sm w-100">Đăng Ký Mượn</a>
                                            }
                                        }
                                        else if (book.Quantity <= 0)
                                        {
                                            <span class="btn btn-outline-secondary btn-sm w-100 disabled">Hết Hàng</span>
                                        }
                                    </div>
                                </div>
                                @if (book.Quantity <= 0)
                                {
                                    <div class="position-absolute top-0 end-0 bg-danger text-white p-1 rounded-start" style="font-size: 0.8rem;">Hết</div>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-info text-center mb-5">
            Không có sách nào để hiển thị.
        </div>
    }
</div>

@section Scripts {
    <script>
        // Thêm hiệu ứng hover cho card
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('mouseenter', () => {
                card.style.transform = 'scale(1.05)';
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'scale(1)';
            });
        });
    </script>
}